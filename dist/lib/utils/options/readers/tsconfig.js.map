{"version":3,"file":"tsconfig.js","sourceRoot":"","sources":["../../../../../src/lib/utils/options/readers/tsconfig.ts"],"names":[],"mappings":"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","sourcesContent":["import * as Path from 'path';\r\nimport * as FS from 'fs';\r\nimport * as _ from 'lodash';\r\nimport * as ts from 'typescript';\r\n\r\nimport { Component, Option } from '../../component';\r\nimport { OptionsComponent, DiscoverEvent } from '../options';\r\nimport { ParameterType, ParameterHint } from '../declaration';\r\nimport { TypeScriptSource } from '../sources/typescript';\r\n\r\n@Component({name: 'options:tsconfig'})\r\nexport class TSConfigReader extends OptionsComponent {\r\n    @Option({\r\n        name: TSConfigReader.OPTIONS_KEY,\r\n        help: 'Specify a typescript config file that should be loaded. If not specified TypeDoc will look for \\'tsconfig.json\\' in the current directory.',\r\n        type: ParameterType.String,\r\n        hint: ParameterHint.File\r\n    })\r\n    options: string;\r\n\r\n    /**\r\n     * The name of the parameter that specifies the tsconfig file.\r\n     */\r\n    private static OPTIONS_KEY = 'tsconfig';\r\n\r\n    /**\r\n     * The name of the parameter that specifies the TS project\r\n     *\r\n     * https://github.com/Microsoft/TypeScript/blob/master/src/compiler/commandLineParser.ts#L49\r\n     */\r\n    private static PROJECT_KEY = 'project';\r\n\r\n    initialize() {\r\n        this.listenTo(this.owner, DiscoverEvent.DISCOVER, this.onDiscover, -100);\r\n    }\r\n\r\n    onDiscover(event: DiscoverEvent) {\r\n        if (TSConfigReader.OPTIONS_KEY in event.data) {\r\n            this.load(event, Path.resolve(event.data[TSConfigReader.OPTIONS_KEY]));\r\n        } else if (TSConfigReader.PROJECT_KEY in event.data) {\r\n            // The `project` option may be a directory or file, so use TS to find it\r\n            let file: string = ts.findConfigFile(event.data[TSConfigReader.PROJECT_KEY], ts.sys.fileExists);\r\n            // If file is undefined, we found no file to load.\r\n            if (file) {\r\n                this.load(event, file);\r\n            }\r\n        } else if (this.application.isCLI) {\r\n            let file: string = ts.findConfigFile('.', ts.sys.fileExists);\r\n            // If file is undefined, we found no file to load.\r\n            if (file) {\r\n                this.load(event, file);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load the specified tsconfig file.\r\n     *\r\n     * @param event  The event that triggered the loading. Used to store error messages.\r\n     * @param fileName  The absolute path and file name of the tsconfig file.\r\n     */\r\n    load(event: DiscoverEvent, fileName: string) {\r\n        if (!FS.existsSync(fileName)) {\r\n            event.addError('The tsconfig file %s does not exist.', fileName);\r\n            return;\r\n        }\r\n\r\n        const { config } = ts.readConfigFile(fileName, ts.sys.readFile);\r\n        if (config === undefined) {\r\n            event.addError('The tsconfig file %s does not contain valid JSON.', fileName);\r\n            return;\r\n        }\r\n        if (!_.isPlainObject(config)) {\r\n            event.addError('The tsconfig file %s does not contain a JSON object.', fileName);\r\n            return;\r\n        }\r\n\r\n        const { fileNames, options, raw: { typedocOptions }} = ts.parseJsonConfigFileContent(\r\n            config,\r\n            ts.sys,\r\n            Path.resolve(Path.dirname(fileName)),\r\n            {},\r\n            Path.resolve(fileName));\r\n\r\n        event.inputFiles = fileNames;\r\n\r\n        const ignored = TypeScriptSource.IGNORED;\r\n        for (const key of ignored) {\r\n            delete options[key];\r\n        }\r\n\r\n        _.defaults(event.data, typedocOptions, options);\r\n    }\r\n}\r\n"]}